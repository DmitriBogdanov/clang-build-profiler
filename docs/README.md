> [!Warning]
> This project is under development. Current documentations acts more like a rough specification of intended features, rather than an accurate representation of the software. Nonetheless, the core functionality is mostly completed.

[<img src ="images/badge_language_cpp_23.svg">](https://en.cppreference.com/w/cpp/23.html)
[<img src ="images/badge_license_mit.svg">](LICENSE.md)
[<img src ="images/badge_semver.svg">](https://semver.org/)
[<img src ="images/badge_docs.svg">](https://dmitribogdanov.github.io/clang-build-profiler/)
<img src ="images/badge_cli_tool.svg">
[<img src ="images/badge_pre_built_binaries.svg">](https://github.com/DmitriBogdanov/clang-build-profiler/releases)

# clang-build-profiler

**clang-build-profiler** is a CLI tool that analyzes timings generated by `clang++ -ftime-trace` and generates a human-readable report, summarizing which parts of the build took the longest.

## Quick showcase

1. Build your project using `clang++` with `-ftime-trace` flag enabled

2. Point the CLI tool at the [CMake]() build directory and select its desired output:

```sh
clang-build-profiler --build=build/ --output=mkdocs
```

3. Open the generated report:

```sh
(cd .cbp && mkdocs serve --open)
```

<img src="images/showcase_mkdocs.png">

4. Available output formats include:

| Type                | Description                                                  | Requirements                  |
| ------------------- | ------------------------------------------------------------ | ----------------------------- |
| `--output=mkdocs`   | Nicest output for viewing, it uses [MkDocs Material](https://squidfunk.github.io/mkdocs-material/) to serve an interactive GUI in browser | `pip install mkdocs-material` |
| `--output=terminal` | Colored in-terminal output, useful for small projects or with high level of pruning | None                          |
| `--output=json`     | JSON dump of profiling data, useful for custom analysis pipelines | None                          |
| `--output=text`     | Text file output, useful for saving human-readable build artifacts with profiling data | None                          |

## Features

- Builds a tree of includes and their parse timings
- Builds a tree of template instantiations and their timings
- Summarizes the information above into a digestible format
- Prettifies standard templates and their expansion (e.g. no `std::basic_string<char, ...>`)
- Automatically analyzes CMake builds with multiple targets

## Documentation

The [project website]() serves as its main form of documentation.

The docs can also be viewed directly from GitHub:

- [Getting started]()
- [Configuration file]()
- [Supported CLI flags]()
- [Profiling a CMake build]()
- [Profiling a Visual Studio build]()
- [Profiling an individual translation unit]()
- [Building the project locally]()
- [Technical limitations]()

A shorter built-in documentation can be accessed with `clang-build-profiler --help`.

## Motivation

In many cases, build times can be noticeably improved through a relatively minor reorganization. To make this feasible, however, one would need a proper tool capable of profiling the build process.

`clang++ -ftime-trace` introduced in version `9.0` provides a perfect backend for such a tool, it generates traces in the [Chrome tracing format](https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU), which can be even opened directly using Chrome `about:tracing`. However, raw traces are quite cumbersome to analyze in respect to the things that we actually care about, so I implemented a tool to summarize the key information.

## Dependencies

The source code of this project embeds several dependencies:

| Library                                         | Version      | License                                                      | Used for                     |
| ----------------------------------------------- | ------------ | ------------------------------------------------------------ | ---------------------------- |
| [UTL](https://github.com/DmitriBogdanov/UTL)    | **v8.3.3**   | [MIT](https://github.com/DmitriBogdanov/UTL/blob/master/docs/LICENSE.md) | Formatting                   |
| [glaze](https://github.com/stephenberry/glaze)  | **v6.0.0**   | [MIT](https://github.com/stephenberry/glaze/blob/main/LICENSE) | JSON parsing & serialization |
| [argparse](https://github.com/p-ranav/argparse) | **v3.2**     | [MIT](https://github.com/p-ranav/argparse/blob/master/LICENSE) | CLI argument parsing         |
| [fkYAML](https://github.com/fktn-k/fkYAML)      | **0.4.2**    | [MIT](https://github.com/fktn-k/fkYAML/blob/main/LICENSE.txt) | YAML parsing                 |
| [cmrc](https://github.com/vector-of-bool/cmrc)  | **#952ffdd** | [MIT](https://github.com/vector-of-bool/cmrc/blob/master/LICENSE.txt) | Embedding resources          |

## Roadmap

- A native GUI output with `--output=gui`
- Refinements in template prettification
- Tests on larger codebases
- A better selection of summaries
- Performance improvements

## License

This project is licensed under the MIT License - see the [LICENSE.md](../LICENSE.md) for details.
